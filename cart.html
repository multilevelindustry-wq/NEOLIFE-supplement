<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Checkout - Neolife Supplements Store</title>
  <link rel="stylesheet" href="./style.css">
  <!-- ✅ PayPal SDK -->
  <script src="https://www.paypal.com/sdk/js?client-id=Aey_vJzSIErk6JUHmkIU41JQ4W1vA2FlfBNf5Vtkg7j4YLaWHkFtw4WSPI0SWiCzhaNKqPt2oGuVIF1n&currency=USD"></script>
</head>

<body>
  <header class="header">
    <h1>Your shopping Cart</h1>
    <a href="index.html" class="back-btn">← Continue Shopping</a>
  </header>

  <section id="cart-section">
    <div id="cart-items"></div>
    <h3 id="total">Total: $0</h3>
    <div id="paypal-button-container"></div>
  </section>

  <footer class="footer">
    <p>© 2025 Neolife Supplements Store. All Rights Reserved.</p>
  </footer>

  <script>
    // ===== LOAD CART FROM LOCALSTORAGE =====
    let cart = JSON.parse(localStorage.getItem("cart")) || [];
    const cartContainer = document.getElementById("cart-items");
    const totalDisplay = document.getElementById("total");

    function renderCart() {
      cartContainer.innerHTML = "";
      let total = 0;

      if (cart.length === 0) {
        cartContainer.innerHTML = "<p><b>Your cart is empty.</b></p>";
        totalDisplay.innerText = "Total: $0";
        document.getElementById("paypal-button-container").style.display = "none";
        return;
      }

      cart.forEach((item, i) => {
        total += item.price;
        const row = document.createElement("div");
        row.classList.add("cart-item");
        row.innerHTML = `
          <img src="${item.img}" alt="${item.name}" width="60">
          <div>
            <h4>${item.name}</h4>
            <p>$${item.price}</p>
          </div>
          <button onclick="removeFromCart(${i})">Remove</button>
        `;
        cartContainer.appendChild(row);
      });

      totalDisplay.innerText = "Total: $" + total.toFixed(2);
    }

    function removeFromCart(index) {
      cart.splice(index, 1);
      localStorage.setItem("cart", JSON.stringify(cart));
      renderCart();
    }

    renderCart();

    // ===== PAYPAL CHECKOUT =====
    if (window.paypal) {
      paypal.Buttons({
        style: {
          color: "gold",
          shape: "pill",
          label: "pay",
          height: 45
        },
        createOrder: function (data, actions) {
          let total = cart.reduce((sum, item) => sum + item.price, 0);
          if (total <= 0) {
            alert("Your cart is empty!");
            return;
          }
          return actions.order.create({
            purchase_units: [{
              amount: { value: total.toFixed(2) },
              description: "Neolife Supplement Store Purchase"
            }]
          });
        },
        onApprove: function (data, actions) {
          return actions.order.capture().then(function (details) {
            alert(`✅ Payment completed successfully by ${details.payer.name.given_name}!`);
            cart = [];
            localStorage.removeItem("cart");
            renderCart();
            window.location.href = "thankyou.html";
          });
        },
        onError: function (err) {
          console.error("❌ PayPal Error:", err);
          alert("An error occurred while processing your payment.");
        }
      }).render("#paypal-button-container");
    }
  </script>
</body>
  </html>
  
